<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Caixa de Vendas - Beleza & Lucro</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body { background:#f0f2f5; padding:10px; }
    .caixa { max-width:1000px; margin:0 auto; background:white; border-radius:20px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.2); }

    /* TELAS */
    .tela { display:none; padding:20px; min-height:90vh; }
    .tela.ativa { display:block; }

    /* TELA 1 */
    .botoes-inicio { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; padding:40px 20px; }
    .btn-inicio { flex:1; min-width:280px; padding:40px; font-size:1.8rem; border-radius:20px; border:none; color:white; cursor:pointer; transition:0.3s; }
    .btn-produto { background:#e74c3c; }
    .btn-servico { background:#9b59b6; }
    .btn-inicio:hover { transform:scale(1.05); }

    /* TELA 2 e 5 */
    .busca { width:100%; padding:15px; font-size:1.4rem; border:2px solid #ddd; border-radius:12px; margin-bottom:15px; }
    .lista-produtos { max-height:50vh; overflow-y:auto; border:1px solid #ddd; border-radius:12px; }
    .item-produto { display:flex; justify-content:space-between; padding:15px; border-bottom:1px solid #eee; cursor:pointer; }
    .item-produto:hover { background:#f8f9fa; }
    .lista-servicos { display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:20px; margin-top:20px; }
    .item-servico { background:#f8f9fa; padding:20px; border-radius:15px; cursor:pointer; transition:0.3s; }
    .item-servico:hover { background:#e8f4fc; transform:translateY(-5px); }

    /* CARRINHO */
    .carrinho { margin-top:20px; }
    .item-carrinho { display:flex; justify-content:space-between; padding:10px; background:#f8f9fa; margin:8px 0; border-radius:8px; }
    .controles-qtd { display:flex; align-items:center; gap:10px; }
    .btn-qtd { width:30px; height:30px; border-radius:50%; border:none; background:#3498db; color:white; cursor:pointer; }
    .total { font-size:2rem; font-weight:bold; text-align:right; margin:20px 0; color:#27ae60; }

    /* BOT√ïES */
    .acoes { display:flex; gap:15px; margin-top:30px; }
    .btn-acao { flex:1; padding:18px; font-size:1.4rem; border:none; border-radius:12px; color:white; cursor:pointer; }
    .btn-cancelar { background:#e74c3c; }
    .btn-pagar { background:#27ae60; }

    /* TELA 3 */
    .formas-pagamento { display:grid; grid-template-columns:repeat(auto-fit, minmax(120px,1fr)); gap:15px; margin:30px 0; }
    .forma { padding:25px; text-align:center; background:#f8f9fa; border-radius:15px; cursor:pointer; font-size:1.2rem; transition:0.3s; }
    .forma:hover { background:#3498db; color:white; }
    .forma.selecionada { background:#3498db; color:white; }

    /* CLIENTE */
    .cliente-selecionado { background:#e8f4fc; padding:15px; border-radius:10px; margin:15px 0; display:flex; justify-content:space-between; align-items:center; }
    .cliente-selecionado button { background:#e74c3c; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; }

    /* OP√á√ïES */
    .painel-opcoes { background:#f8f9fa; padding:20px; border-radius:15px; margin:20px 0; display:none; }
    .painel-opcoes.ativo { display:block; }
    .opcoes-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-top:15px; }
    .opcao { background:white; padding:15px; border-radius:10px; text-align:center; cursor:pointer; transition:0.3s; }
    .opcao:hover { background:#3498db; color:white; }
    .input-opcao { width:100%; padding:10px; margin-top:10px; border:1px solid #ddd; border-radius:5px; }

    /* TAXAS */
    .taxas-linha { display:flex; justify-content:space-between; margin:5px 0; }
    .taxas-ocultas { display:none; }
    .taxas-visiveis { display:block; }
    .toggle-taxas { background:#95a5a6; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; margin-top:10px; }

    /* MODAIS */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; }
    .modal-conteudo { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:30px; border-radius:15px; width:90%; max-width:400px; }
    .modal-titulo { margin-bottom:20px; text-align:center; }
    .modal-inputs { display:flex; gap:10px; margin-bottom:20px; }
    .modal-input { flex:1; padding:10px; border:1px solid #ddd; border-radius:5px; }
    .modal-botoes { display:flex; gap:10px; }
    .modal-btn { flex:1; padding:10px; border:none; border-radius:5px; cursor:pointer; }
    .modal-btn.confirmar { background:#27ae60; color:white; }
    .modal-btn.cancelar { background:#e74c3c; color:white; }
    .tipo-valor { display:flex; margin-top:10px; }
    .btn-tipo { flex:1; padding:8px; border:1px solid #ddd; background:white; cursor:pointer; }
    .btn-tipo.ativo { background:#3498db; color:white; }

    /* TELA 6 */
    .valor-pagamento { text-align:center; margin:30px 0; }
    .valor-input { font-size:2rem; padding:15px; width:100%; max-width:300px; text-align:center; border:2px solid #3498db; border-radius:10px; margin:20px 0; }
    .parcelamento { margin:20px 0; }
    .parcelas { display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; margin-top:10px; }
    .parcela { padding:15px; text-align:center; background:#f8f9fa; border-radius:10px; cursor:pointer; }
    .parcela.selecionada { background:#3498db; color:white; }

    /* TELA 7 */
    .formas-adicionadas { margin:20px 0; }
    .forma-adicionada { display:flex; justify-content:space-between; padding:15px; background:#f8f9fa; margin:10px 0; border-radius:10px; }
    .saldo-restante { font-size:1.5rem; text-align:center; margin:20px 0; padding:15px; background:#e8f4fc; border-radius:10px; }

    /* TELA 8 */
    .resumo-cliente { background:#f8f9fa; padding:20px; border-radius:15px; margin:20px 0; }
    .info-cliente { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin:15px 0; }
    .info-item { background:white; padding:15px; border-radius:10px; text-align:center; }
    .avaliacao { font-size:1.2rem; font-weight:bold; margin:10px 0; }
    .boa { color:#27ae60; }
    .ruim { color:#e74c3c; }
    .regular { color:#f39c12; }
    .historico { max-height:200px; overflow-y:auto; margin:15px 0; }
    .item-historico { padding:10px; border-bottom:1px solid #eee; }

    /* TELA 9 - COMPROVANTE */
    .comprovante-virtual { background:white; padding:30px; margin:20px auto; max-width:500px; text-align:center; border:2px solid #27ae60; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
    .comprovante-virtual h2 { margin-bottom:20px; color:#27ae60; }
    .logo { font-size:3rem; margin-bottom:10px; color:#2c3e50; }
    .qr { width:150px; height:150px; background:#eee; margin:20px auto; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:0.8rem; color:#666; }
    .detalhes-venda { text-align:left; margin:20px 0; }
    .linha-detalhe { display:flex; justify-content:space-between; margin:8px 0; padding:8px 0; border-bottom:1px dashed #eee; }
    .itens-venda { margin:15px 0; max-height:200px; overflow-y:auto; }
    .item-venda { display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid #f0f0f0; }
    .total-venda { font-size:1.5rem; font-weight:bold; text-align:right; margin:20px 0; padding-top:15px; border-top:2px solid #333; color:#27ae60; }
    .acoes-comprovante { display:flex; gap:15px; justify-content:center; margin-top:30px; flex-wrap:wrap; }
    .btn-comprovante { padding:15px 25px; border:none; border-radius:10px; font-size:1.2rem; cursor:pointer; transition:0.3s; }
    .btn-pdf { background:#e74c3c; color:white; }
    .btn-pdf:hover { background:#c0392b; transform:scale(1.05); }
    .btn-compartilhar { background:#3498db; color:white; }
    .btn-compartilhar:hover { background:#2980b9; transform:scale(1.05); }
    .btn-nova-venda { background:#27ae60; color:white; }
    .btn-nova-venda:hover { background:#219a52; transform:scale(1.05); }

    @media (max-width:768px) {
      .botoes-inicio { flex-direction:column; }
      .btn-inicio { font-size:1.5rem; padding:30px; }
      .acoes { flex-direction:column; }
      .parcelas { grid-template-columns:repeat(2, 1fr); }
      .acoes-comprovante { flex-direction:column; }
      .btn-comprovante { width:100%; }
    }
  </style>
</head>
<body>

<div class="caixa">
  <!-- TELA 1 -->
  <div id="tela1" class="tela ativa">
    <h1 style="text-align:center; padding:20px; background:#2c3e50; color:white;">CAIXA DE VENDAS</h1>
    <div class="botoes-inicio">
      <button class="btn-inicio btn-produto" onclick="irPara('tela2')">PRODUTOS</button>
      <button class="btn-inicio btn-servico" onclick="irPara('tela5')">SERVI√áOS</button>
    </div>
  </div>

  <!-- TELA 2 -->
  <div id="tela2" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Adicionar Produtos</h2>
    <input type="text" class="busca" placeholder="Digite nome ou c√≥digo do produto..." onkeyup="filtrarProdutos(this.value)">
    
    <div class="lista-produtos" id="lista-produtos">
      <div class="item-produto" onclick="addItem('001 - Creme Facial 50g', 69.90)">001 - Creme Facial 50g <strong>R$ 69,90</strong></div>
      <div class="item-produto" onclick="addItem('002 - Protetor Solar', 89.00)">002 - Protetor Solar <strong>R$ 89,00</strong></div>
      <div class="item-produto" onclick="addItem('003 - √ìleo Corporal', 64.90)">003 - √ìleo Corporal <strong>R$ 64,90</strong></div>
      <div class="item-produto" onclick="addItem('004 - Shampoo Revitalizante', 45.90)">004 - Shampoo Revitalizante <strong>R$ 45,90</strong></div>
    </div>

    <div class="carrinho">
      <h3>Itens no carrinho:</h3>
      <div id="carrinho-itens"></div>
      <div class="total">Total: R$ <span id="total">0,00</span></div>
    </div>

    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="limparCarrinho()">Cancelar Compra</button>
      <button class="btn-acao btn-pagar" onclick="irPara('tela3')">Ir para Pagamento ‚Üí</button>
    </div>
  </div>

  <!-- TELA 3 -->
  <div id="tela3" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Finalizar Venda</h2>
    
    <input type="text" class="busca" placeholder="Buscar cliente por nome ou c√≥digo..." onkeyup="buscarCliente(this.value)">
    <div id="cliente-selecionado" class="cliente-selecionado" style="display:none;">
      <span id="nome-cliente"></span>
      <button onclick="removerCliente()">Remover</button>
    </div>
    
    <div class="carrinho">
      <h3>Itens selecionados:</h3>
      <div id="carrinho-final"></div>
      
      <div id="taxas-descontos" class="taxas-visiveis">
        <div class="taxas-linha">
          <span>Subtotal:</span>
          <span>R$ <span id="subtotal">0,00</span></span>
        </div>
        <div class="taxas-linha">
          <span>Desconto:</span>
          <span>- R$ <span id="valor-desconto">0,00</span></span>
        </div>
        <div class="taxas-linha">
          <span>Taxa de servi√ßo:</span>
          <span>+ R$ <span id="valor-taxa">0,00</span></span>
        </div>
      </div>
      
      <div class="total">Total: R$ <span id="total-final">0,00</span></div>
      <button class="toggle-taxas" onclick="toggleTaxas()">Ocultar Taxas</button>
    </div>

    <button class="btn-acao" style="background:#f39c12;" onclick="toggleOpcoes()">Op√ß√µes</button>
    
    <div id="painel-opcoes" class="painel-opcoes">
      <h3>Op√ß√µes Avan√ßadas</h3>
      <div class="opcoes-grid">
        <div class="opcao" onclick="salvarPedido()">Salvar Pedido</div>
        <div class="opcao" onclick="abrirModalDesconto()">Aplicar Desconto</div>
        <div class="opcao" onclick="abrirModalTaxa()">Adicionar Taxa</div>
        <div class="opcao" onclick="alterarData()">
          Alterar Data
          <input type="datetime-local" id="input-data" class="input-opcao">
        </div>
      </div>
    </div>

    <h3>Forma de Pagamento</h3>
    <div class="formas-pagamento">
      <div class="forma" onclick="selecionarFormaPagamento('DINHEIRO')">DINHEIRO</div>
      <div class="forma" onclick="selecionarFormaPagamento('PIX')">PIX</div>
      <div class="forma" onclick="selecionarFormaPagamento('D√âBITO')">D√âBITO</div>
      <div class="forma" onclick="selecionarFormaPagamento('CR√âDITO')">CR√âDITO</div>
      <div class="forma" onclick="selecionarFormaPagamento('A PRAZO')">A PRAZO</div>
      <div class="forma" onclick="selecionarFormaPagamento('OUTRO')" style="background:#95a5a6;">OUTRO</div>
    </div>
    
    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="voltar()">Cancelar</button>
      <button class="btn-acao btn-pagar" onclick="finalizarVenda()">Finalizar Venda</button>
    </div>
  </div>

  <!-- TELA 5 -->
  <div id="tela5" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Adicionar Servi√ßos</h2>
    <input type="text" class="busca" placeholder="Buscar servi√ßo..." onkeyup="filtrarServicos(this.value)">
    
    <div class="lista-servicos" id="lista-servicos">
      <div class="item-servico" onclick="addItem('Corte de Cabelo Feminino', 80.00)">
        <h3>Corte de Cabelo Feminino</h3>
        <p>R$ 80,00</p>
      </div>
      <div class="item-servico" onclick="addItem('Colora√ß√£o Completa', 150.00)">
        <h3>Colora√ß√£o Completa</h3>
        <p>R$ 150,00</p>
      </div>
      <div class="item-servico" onclick="addItem('Manicure e Pedicure', 60.00)">
        <h3>Manicure e Pedicure</h3>
        <p>R$ 60,00</p>
      </div>
    </div>

    <div class="carrinho">
      <h3>Itens no carrinho:</h3>
      <div id="carrinho-servicos"></div>
      <div class="total">Total: R$ <span id="total-servicos">0,00</span></div>
    </div>

    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="limparCarrinho()">Cancelar Compra</button>
      <button class="btn-acao btn-pagar" onclick="irPara('tela3')">Ir para Pagamento ‚Üí</button>
    </div>
  </div>

  <!-- TELA 6 -->
  <div id="tela6" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Pagamento em <span id="forma-pagamento-atual"></span></h2>
    
    <div class="valor-pagamento">
      <h3>Valor a pagar: R$ <span id="valor-total-pagar">0,00</span></h3>
      <input type="number" id="valor-pagamento-input" class="valor-input" placeholder="0,00" step="0.01" min="0">
      
      <div id="parcelamento-section" class="parcelamento" style="display:none;">
        <h4>Parcelamento:</h4>
        <div class="parcelas">
          <div class="parcela" onclick="selecionarParcela(1)">1x</div>
          <div class="parcela" onclick="selecionarParcela(2)">2x</div>
          <div class="parcela" onclick="selecionarParcela(3)">3x</div>
          <div class="parcela" onclick="selecionarParcela(4)">4x</div>
          <div class="parcela" onclick="selecionarParcela(5)">5x</div>
          <div class="parcela" onclick="selecionarParcela(6)">6x</div>
        </div>
        <div id="valor-parcela" style="text-align:center; margin:10px 0; font-weight:bold;"></div>
      </div>
    </div>
    
    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="voltar()">Cancelar</button>
      <button class="btn-acao btn-pagar" onclick="adicionarFormaPagamento()">Adicionar Pagamento</button>
    </div>
  </div>

  <!-- TELA 7 -->
  <div id="tela7" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Formas de Pagamento</h2>
    
    <div class="saldo-restante">
      Saldo restante: R$ <span id="saldo-restante">0,00</span>
    </div>
    
    <div class="formas-adicionadas" id="formas-adicionadas"></div>
    
    <div class="formas-pagamento">
      <div class="forma" onclick="selecionarFormaPagamento('DINHEIRO')">DINHEIRO</div>
      <div class="forma" onclick="selecionarFormaPagamento('PIX')">PIX</div>
      <div class="forma" onclick="selecionarFormaPagamento('D√âBITO')">D√âBITO</div>
      <div class="forma" onclick="selecionarFormaPagamento('CR√âDITO')">CR√âDITO</div>
      <div class="forma" onclick="selecionarFormaPagamento('A PRAZO')">A PRAZO</div>
      <div class="forma" onclick="selecionarFormaPagamento('OUTRO')" style="background:#95a5a6;">OUTRO</div>
    </div>
    
    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="voltar()">Cancelar</button>
      <button class="btn-acao btn-pagar" onclick="irPara('tela8')">Continuar</button>
    </div>
  </div>

  <!-- TELA 8 -->
  <div id="tela8" class="tela">
    <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
    <h2>Confirma√ß√£o da Venda</h2>
    
    <div class="resumo-cliente" id="resumo-cliente"></div>
    
    <div class="carrinho">
      <h3>Resumo da Venda:</h3>
      <div id="resumo-venda"></div>
      <div class="total">Total: R$ <span id="total-resumo">0,00</span></div>
    </div>
    
    <div class="acoes">
      <button class="btn-acao btn-cancelar" onclick="voltar()">N√£o</button>
      <button class="btn-acao btn-pagar" onclick="finalizarVendaCompleta()">Sim, Confirmar</button>
    </div>
  </div>

  <!-- TELA 9 - COMPROVANTE -->
  <div id="tela9" class="tela">
    <div class="comprovante-virtual">
      <div class="logo">Beleza & Lucro</div>
      <h2>COMPROVANTE DE VENDA</h2>
      
      <div class="detalhes-venda">
        <div class="linha-detalhe">
          <span><strong>Data/Hora:</strong></span>
          <span id="comprovante-data"></span>
        </div>
        <div class="linha-detalhe">
          <span><strong>N¬∫ da Venda:</strong></span>
          <span id="comprovante-numero"></span>
        </div>
        <div class="linha-detalhe">
          <span><strong>Cliente:</strong></span>
          <span id="comprovante-cliente"></span>
        </div>
        <div class="linha-detalhe">
          <span><strong>Vendedor:</strong></span>
          <span>Atendente 01</span>
        </div>
      </div>
      
      <h3 style="text-align:left; margin-top:20px;">Itens da Venda:</h3>
      <div class="itens-venda" id="comprovante-itens"></div>
      
      <div class="detalhes-venda">
        <div class="linha-detalhe">
          <span><strong>Subtotal:</strong></span>
          <span>R$ <span id="comprovante-subtotal">0,00</span></span>
        </div>
        <div class="linha-detalhe">
          <span><strong>Desconto:</strong></span>
          <span>- R$ <span id="comprovante-desconto">0,00</span></span>
        </div>
        <div class="linha-detalhe" style="border-top:2px solid #333; font-weight:bold;">
          <span><strong>Total:</strong></span>
          <span>R$ <span id="comprovante-total">0,00</span></span>
        </div>
      </div>
      
      <h3 style="text-align:left; margin-top:20px;">Formas de Pagamento:</h3>
      <div id="comprovante-pagamentos"></div>
      
      <div class="qr">
        <div>QR CODE PIX<br>Para pagamento</div>
      </div>
      
      <p style="margin-top:20px; font-style:italic;">
        Obrigado pela prefer√™ncia!<br>
        Volte sempre!
      </p>
      
      <div class="acoes-comprovante">
        <button class="btn-comprovante btn-pdf" onclick="gerarPDF()">üìÑ Gerar PDF</button>
        <button class="btn-comprovante btn-compartilhar" onclick="compartilharComCliente()">üì§ Compartilhar</button>
        <button class="btn-comprovante btn-nova-venda" onclick="novaVenda()">üõí Nova Venda</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAIS -->
<div id="modal-desconto" class="modal">
  <div class="modal-conteudo">
    <h3 class="modal-titulo">Aplicar Desconto</h3>
    <div class="tipo-valor">
      <button id="btn-desconto-reais" class="btn-tipo ativo" onclick="selecionarTipoDesconto('reais')">R$</button>
      <button id="btn-desconto-porcentagem" class="btn-tipo" onclick="selecionarTipoDesconto('porcentagem')">%</button>
    </div>
    <div class="modal-inputs">
      <input type="number" id="input-desconto" class="modal-input" placeholder="Valor" min="0" step="0.01">
    </div>
    <div class="modal-botoes">
      <button class="modal-btn cancelar" onclick="fecharModalDesconto()">Cancelar</button>
      <button class="modal-btn confirmar" onclick="aplicarDesconto()">Aplicar</button>
    </div>
  </div>
</div>

<div id="modal-taxa" class="modal">
  <div class="modal-conteudo">
    <h3 class="modal-titulo">Adicionar Taxa</h3>
    <div class="tipo-valor">
      <button id="btn-taxa-reais" class="btn-tipo ativo" onclick="selecionarTipoTaxa('reais')">R$</button>
      <button id="btn-taxa-porcentagem" class="btn-tipo" onclick="selecionarTipoTaxa('porcentagem')">%</button>
    </div>
    <div class="modal-inputs">
      <input type="number" id="input-taxa" class="modal-input" placeholder="Valor" min="0" step="0.01">
    </div>
    <div class="modal-botoes">
      <button class="modal-btn cancelar" onclick="fecharModalTaxa()">Cancelar</button>
      <button class="modal-btn confirmar" onclick="aplicarTaxa()">Aplicar</button>
    </div>
  </div>
</div>

<script>
  // VARI√ÅVEIS GLOBAIS
  let carrinho = [];
  let total = 0;
  let subtotal = 0;
  let desconto = 0;
  let descontoPorcentagem = 0;
  let taxa = 0;
  let taxaPorcentagem = 0;
  let formasPagamento = [];
  let saldoRestante = 0;
  let parcelaSelecionada = 1;
  let formaPagamentoAtual = '';
  let clienteSelecionado = null;
  let dataVenda = new Date();
  let taxasVisiveis = true;
  let tipoDescontoAtual = 'reais';
  let tipoTaxaAtual = 'reais';

  // CLIENTES
  const clientes = [
    { id: '001', nome: 'Maria Silva', quantidadeVendas: 15, mediaAvaliacao: 'Boa' },
    { id: '002', nome: 'Jo√£o Santos', quantidadeVendas: 8, mediaAvaliacao: 'Regular' },
    { id: '003', nome: 'Ana Oliveira', quantidadeVendas: 25, mediaAvaliacao: 'Excelente' }
  ];

  // FUN√á√ïES PRINCIPAIS
  function irPara(tela) {
    document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
    document.getElementById(tela).classList.add('ativa');
    
    if (tela === 'tela3') atualizarFinal();
    if (tela === 'tela6') prepararTelaPagamento();
    if (tela === 'tela7') atualizarFormasPagamento();
    if (tela === 'tela8') atualizarResumoCliente();
    if (tela === 'tela9') atualizarComprovanteVirtual();
  }

  function voltar() {
    const telas = ['tela1','tela2','tela3','tela5','tela6','tela7','tela8','tela9'];
    const atual = document.querySelector('.tela.ativa').id;
    const idx = telas.indexOf(atual);
    if (idx > 0) irPara(telas[idx-1]);
  }

  // FUN√á√ïES DO CARRINHO
  function addItem(nome, preco) {
    const itemExistente = carrinho.find(item => item.nome === nome);
    if (itemExistente) {
      itemExistente.qtd += 1;
    } else {
      carrinho.push({nome, preco, qtd:1});
    }
    atualizarCarrinho();
  }

  function atualizarCarrinho() {
    const itens = document.getElementById('carrinho-itens');
    const itensServicos = document.getElementById('carrinho-servicos');
    itens.innerHTML = '';
    itensServicos.innerHTML = '';
    subtotal = 0;
    
    if (carrinho.length === 0) {
      itens.innerHTML = '<p>Carrinho vazio</p>';
      itensServicos.innerHTML = '<p>Carrinho vazio</p>';
    } else {
      carrinho.forEach((item,i) => {
        subtotal += item.preco * item.qtd;
        const itemHTML = `
          <div class="item-carrinho">
            <span>${item.nome}</span>
            <div class="controles-qtd">
              <button class="btn-qtd" onclick="alterarQtd(${i}, -1)">-</button>
              <span>${item.qtd}</span>
              <button class="btn-qtd" onclick="alterarQtd(${i}, 1)">+</button>
            </div>
            <span>R$ ${(item.preco*item.qtd).toFixed(2)}</span>
            <button onclick="remover(${i})" style="background:#e74c3c; color:white; border:none; padding:5px 10px; border-radius:5px;">X</button>
          </div>`;
        
        itens.innerHTML += itemHTML;
        itensServicos.innerHTML += itemHTML;
      });
    }
    
    calcularTotal();
    document.getElementById('total').textContent = total.toFixed(2);
    document.getElementById('total-servicos').textContent = total.toFixed(2);
  }

  function calcularTotal() {
    if (tipoDescontoAtual === 'porcentagem' && descontoPorcentagem > 0) {
      desconto = (subtotal * descontoPorcentagem) / 100;
    }
    
    if (tipoTaxaAtual === 'porcentagem' && taxaPorcentagem > 0) {
      taxa = (subtotal * taxaPorcentagem) / 100;
    }
    
    total = subtotal - desconto + taxa;
    
    document.getElementById('subtotal').textContent = subtotal.toFixed(2);
    document.getElementById('valor-desconto').textContent = desconto.toFixed(2);
    document.getElementById('valor-taxa').textContent = taxa.toFixed(2);
    document.getElementById('total-final').textContent = total.toFixed(2);
  }

  function alterarQtd(i, delta) {
    carrinho[i].qtd += delta;
    if (carrinho[i].qtd <= 0) carrinho.splice(i, 1);
    atualizarCarrinho();
  }

  function remover(i) {
    carrinho.splice(i,1);
    atualizarCarrinho();
  }

  function limparCarrinho() {
    carrinho = []; 
    subtotal = 0;
    desconto = 0;
    descontoPorcentagem = 0;
    taxa = 0;
    taxaPorcentagem = 0;
    total = 0;
    formasPagamento = [];
    saldoRestante = 0;
    atualizarCarrinho();
  }

  // FUN√á√ïES DE BUSCA
  function filtrarProdutos(termo) {
    const itens = document.querySelectorAll('#lista-produtos .item-produto');
    itens.forEach(item => {
      const texto = item.textContent.toLowerCase();
      item.style.display = texto.includes(termo.toLowerCase()) ? 'flex' : 'none';
    });
  }

  function filtrarServicos(termo) {
    const itens = document.querySelectorAll('#lista-servicos .item-servico');
    itens.forEach(item => {
      const texto = item.textContent.toLowerCase();
      item.style.display = texto.includes(termo.toLowerCase()) ? 'block' : 'none';
    });
  }

  function buscarCliente(termo) {
    if (termo.length < 2) return;
    const clienteEncontrado = clientes.find(cliente => 
      cliente.nome.toLowerCase().includes(termo.toLowerCase()) || cliente.id.includes(termo)
    );
    
    if (clienteEncontrado) {
      clienteSelecionado = clienteEncontrado;
      document.getElementById('cliente-selecionado').style.display = 'flex';
      document.getElementById('nome-cliente').textContent = `${clienteSelecionado.nome} (${clienteSelecionado.id})`;
    }
  }

  function removerCliente() {
    clienteSelecionado = null;
    document.getElementById('cliente-selecionado').style.display = 'none';
  }

  // FUN√á√ïES DE PAGAMENTO
  function selecionarFormaPagamento(forma) {
    formaPagamentoAtual = forma;
    saldoRestante = total;
    irPara('tela6');
  }

  function prepararTelaPagamento() {
    document.getElementById('forma-pagamento-atual').textContent = formaPagamentoAtual;
    document.getElementById('valor-total-pagar').textContent = saldoRestante.toFixed(2);
    document.getElementById('valor-pagamento-input').value = '';
    
    const parcelamentoSection = document.getElementById('parcelamento-section');
    if (formaPagamentoAtual === 'CR√âDITO' || formaPagamentoAtual === 'A PRAZO') {
      parcelamentoSection.style.display = 'block';
      selecionarParcela(1);
    } else {
      parcelamentoSection.style.display = 'none';
    }
  }

  function selecionarParcela(numero) {
    parcelaSelecionada = numero;
    document.querySelectorAll('.parcela').forEach(p => p.classList.remove('selecionada'));
    event.target.classList.add('selecionada');
    
    const valorParcela = saldoRestante / numero;
    document.getElementById('valor-parcela').textContent = `${numero}x de R$ ${valorParcela.toFixed(2)}`;
  }

  function adicionarFormaPagamento() {
    const valorDigitado = parseFloat(document.getElementById('valor-pagamento-input').value) || 0;
    
    if (valorDigitado <= 0) {
      alert('Digite um valor v√°lido');
      return;
    }
    
    const forma = {
      tipo: formaPagamentoAtual,
      valor: valorDigitado,
      parcelas: (formaPagamentoAtual === 'CR√âDITO' || formaPagamentoAtual === 'A PRAZO') ? parcelaSelecionada : 1
    };
    
    formasPagamento.push(forma);
    
    const totalPago = formasPagamento.reduce((sum, forma) => sum + forma.valor, 0);
    saldoRestante = total - totalPago;
    
    if (saldoRestante <= 0) {
      irPara('tela8');
    } else {
      irPara('tela7');
    }
  }

  function atualizarFormasPagamento() {
    const container = document.getElementById('formas-adicionadas');
    container.innerHTML = '';
    
    formasPagamento.forEach((forma, index) => {
      const div = document.createElement('div');
      div.className = 'forma-adicionada';
      div.innerHTML = `
        <span>${forma.tipo} ${forma.parcelas > 1 ? `(${forma.parcelas}x)` : ''}</span>
        <span>R$ ${forma.valor.toFixed(2)}</span>
        <button onclick="removerFormaPagamento(${index})" style="background:#e74c3c; color:white; border:none; padding:5px 10px; border-radius:5px;">X</button>
      `;
      container.appendChild(div);
    });
    
    document.getElementById('saldo-restante').textContent = saldoRestante.toFixed(2);
  }

  function removerFormaPagamento(index) {
    formasPagamento.splice(index, 1);
    const totalPago = formasPagamento.reduce((sum, forma) => sum + forma.valor, 0);
    saldoRestante = total - totalPago;
    atualizarFormasPagamento();
  }

  // FUN√á√ïES DAS OP√á√ïES
  function toggleOpcoes() {
    const painel = document.getElementById('painel-opcoes');
    painel.classList.toggle('ativo');
  }

  function salvarPedido() {
    alert('Pedido salvo com sucesso!');
  }

  function alterarData() {
    const inputData = document.getElementById('input-data');
    const novaData = inputData.value;
    if (novaData) {
      dataVenda = new Date(novaData);
      alert('Data alterada para: ' + dataVenda.toLocaleString('pt-BR'));
    }
  }

  function toggleTaxas() {
    const taxasDiv = document.getElementById('taxas-descontos');
    const botao = document.querySelector('.toggle-taxas');
    
    if (taxasVisiveis) {
      taxasDiv.classList.remove('taxas-visiveis');
      taxasDiv.classList.add('taxas-ocultas');
      botao.textContent = 'Mostrar Taxas';
    } else {
      taxasDiv.classList.remove('taxas-ocultas');
      taxasDiv.classList.add('taxas-visiveis');
      botao.textContent = 'Ocultar Taxas';
    }
    
    taxasVisiveis = !taxasVisiveis;
  }

  // FUN√á√ïES DOS MODAIS
  function abrirModalDesconto() {
    document.getElementById('modal-desconto').style.display = 'block';
    document.getElementById('input-desconto').value = tipoDescontoAtual === 'reais' ? desconto : descontoPorcentagem;
  }

  function fecharModalDesconto() {
    document.getElementById('modal-desconto').style.display = 'none';
  }

  function abrirModalTaxa() {
    document.getElementById('modal-taxa').style.display = 'block';
    document.getElementById('input-taxa').value = tipoTaxaAtual === 'reais' ? taxa : taxaPorcentagem;
  }

  function fecharModalTaxa() {
    document.getElementById('modal-taxa').style.display = 'none';
  }

  function selecionarTipoDesconto(tipo) {
    tipoDescontoAtual = tipo;
    document.getElementById('btn-desconto-reais').classList.toggle('ativo', tipo === 'reais');
    document.getElementById('btn-desconto-porcentagem').classList.toggle('ativo', tipo === 'porcentagem');
  }

  function selecionarTipoTaxa(tipo) {
    tipoTaxaAtual = tipo;
    document.getElementById('btn-taxa-reais').classList.toggle('ativo', tipo === 'reais');
    document.getElementById('btn-taxa-porcentagem').classList.toggle('ativo', tipo === 'porcentagem');
  }

  function aplicarDesconto() {
    const valor = parseFloat(document.getElementById('input-desconto').value) || 0;
    
    if (tipoDescontoAtual === 'reais') {
      desconto = valor;
      descontoPorcentagem = (desconto / subtotal) * 100;
    } else {
      descontoPorcentagem = valor;
      desconto = (subtotal * descontoPorcentagem) / 100;
    }
    
    calcularTotal();
    fecharModalDesconto();
  }

  function aplicarTaxa() {
    const valor = parseFloat(document.getElementById('input-taxa').value) || 0;
    
    if (tipoTaxaAtual === 'reais') {
      taxa = valor;
      taxaPorcentagem = (taxa / subtotal) * 100;
    } else {
      taxaPorcentagem = valor;
      taxa = (subtotal * taxaPorcentagem) / 100;
    }
    
    calcularTotal();
    fecharModalTaxa();
  }

  // FUN√á√ïES FINAIS
  function finalizarVenda() {
    formasPagamento = [];
    saldoRestante = total;
    irPara('tela7');
  }

  function atualizarFinal() {
    document.getElementById('carrinho-final').innerHTML = document.getElementById('carrinho-itens').innerHTML;
    calcularTotal();
  }

  function atualizarResumoCliente() {
    const container = document.getElementById('resumo-cliente');
    
    if (clienteSelecionado) {
      const cliente = clientes.find(c => c.id === clienteSelecionado.id);
      let classeAvaliacao = '';
      if (cliente.mediaAvaliacao === 'Excelente' || cliente.mediaAvaliacao === 'Boa') {
        classeAvaliacao = 'boa';
      } else if (cliente.mediaAvaliacao === 'Regular') {
        classeAvaliacao = 'regular';
      } else {
        classeAvaliacao = 'ruim';
      }
      
      container.innerHTML = `
        <h3>Resumo do Cliente</h3>
        <div class="info-cliente">
          <div class="info-item">
            <strong>Nome</strong><br>${cliente.nome}
          </div>
          <div class="info-item">
            <strong>Quantidade de Vendas</strong><br>${cliente.quantidadeVendas}
          </div>
          <div class="info-item">
            <strong>M√©dia de Rela√ß√£o</strong><br>
            <span class="avaliacao ${classeAvaliacao}">${cliente.mediaAvaliacao}</span>
          </div>
        </div>
      `;
    } else {
      container.innerHTML = `
        <h3>Cliente N√£o Identificado</h3>
        <p>Esta venda ser√° registrada sem cliente associado.</p>
      `;
    }
    
    document.getElementById('resumo-venda').innerHTML = document.getElementById('carrinho-itens').innerHTML;
    document.getElementById('total-resumo').textContent = total.toFixed(2);
  }

  function finalizarVendaCompleta() {
    const totalPago = formasPagamento.reduce((sum, forma) => sum + forma.valor, 0);
    
    if (Math.abs(totalPago - total) > 0.01) {
      alert('O valor pago n√£o corresponde ao total da venda!');
      return;
    }
    
    irPara('tela9');
  }

  function atualizarComprovanteVirtual() {
    const agora = new Date();
    document.getElementById('comprovante-data').textContent = agora.toLocaleString('pt-BR');
    document.getElementById('comprovante-numero').textContent = 'V' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    document.getElementById('comprovante-cliente').textContent = clienteSelecionado ? clienteSelecionado.nome : 'Cliente n√£o identificado';
    
    const itensContainer = document.getElementById('comprovante-itens');
    itensContainer.innerHTML = '';
    carrinho.forEach(item => {
      const div = document.createElement('div');
      div.className = 'item-venda';
      div.innerHTML = `<span>${item.nome} (${item.qtd}x)</span><span>R$ ${(item.preco * item.qtd).toFixed(2)}</span>`;
      itensContainer.appendChild(div);
    });
    
    const totalSemTaxa = subtotal - desconto;
    document.getElementById('comprovante-subtotal').textContent = subtotal.toFixed(2);
    document.getElementById('comprovante-desconto').textContent = desconto.toFixed(2);
    document.getElementById('comprovante-total').textContent = totalSemTaxa.toFixed(2);
    
    const pagamentosContainer = document.getElementById('comprovante-pagamentos');
    pagamentosContainer.innerHTML = '';
    formasPagamento.forEach(forma => {
      const div = document.createElement('div');
      div.className = 'linha-detalhe';
      div.innerHTML = `<span>${forma.tipo} ${forma.parcelas > 1 ? `(${forma.parcelas}x)` : ''}</span><span>R$ ${forma.valor.toFixed(2)}</span>`;
      pagamentosContainer.appendChild(div);
    });
  }

  function gerarPDF() {
    const numeroVenda = document.getElementById('comprovante-numero').textContent;
    alert(`PDF da venda ${numeroVenda} gerado com sucesso!\n\nEm um sistema real, o arquivo seria baixado automaticamente.`);
  }

  function compartilharComCliente() {
    const numeroVenda = document.getElementById('comprovante-numero').textContent;
    if (clienteSelecionado) {
      alert(`Comprovante da venda ${numeroVenda} enviado para ${clienteSelecionado.nome}!`);
    } else {
      alert(`Comprovante da venda ${numeroVenda} pronto para compartilhamento!`);
    }
  }

  function novaVenda() {
    limparCarrinho();
    clienteSelecionado = null;
    formasPagamento = [];
    saldoRestante = 0;
    document.getElementById('cliente-selecionado').style.display = 'none';
    document.getElementById('painel-opcoes').classList.remove('ativo');
    irPara('tela1');
  }

  // ESTILO DO BOT√ÉO VOLTAR
  const style = document.createElement('style');
  style.textContent = `
    .btn-voltar {
      padding:10px 20px; 
      background:#3498db; 
      color:white; 
      border:none; 
      border-radius:10px;
      margin-bottom: 20px;
      cursor: pointer;
    }
  `;
  document.head.appendChild(style);
</script>
</body>
</html>